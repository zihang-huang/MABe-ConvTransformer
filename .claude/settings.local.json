{
  "permissions": {
    "allow": [
      "Bash(python -c:*)",
      "Bash(.venvScriptsactivate)",
      "Bash(.venv/Scripts/python.exe:*)",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\" -c:*)",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\":*)",
      "Bash(del \"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\check_labels.py\")",
      "Bash(dir \"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\outputs\\\\checkpoints\")",
      "Bash(dir:*)",
      "Bash(powershell -Command \"Get-ChildItem -Path ''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer'' | Select-Object Name\")",
      "Bash(powershell -Command \"Get-ChildItem -Path ''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\`$paths.data_dir\\\\checkpoints'' | Select-Object Name, Length\")",
      "Bash(python3:*)",
      "Bash(find:*)",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\" -c \"import pandas as pd; df = pd.read_csv\\(r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\kaggle\\\\input\\\\MABe-mouse-behavior-detection\\\\test.csv''\\); print\\(''behaviors_labeled for test video:''\\); print\\(df[''behaviors_labeled''].iloc[0][:500]\\)\")",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\" -c \"import pandas as pd; df = pd.read_csv\\(r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\kaggle\\\\input\\\\MABe-mouse-behavior-detection\\\\train.csv''\\); print\\(''behaviors_labeled sample from train.csv:''\\); print\\(df[''behaviors_labeled''].iloc[0][:500]\\)\")",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\" -c \"\nimport sys\nsys.path.insert\\(0, r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer''\\)\n\nimport pandas as pd\nfrom src.utils.kaggle_metric import mouse_fbeta\n\n# Test: Check what happens with integer vs string agent_id\nprint\\(''Test: Integer vs String agent_id''\\)\nsolution = pd.DataFrame\\([\n    {''video_id'': 1, ''agent_id'': ''mouse1'', ''target_id'': ''mouse2'', ''action'': ''attack'', \n     ''start_frame'': 0, ''stop_frame'': 10, ''lab_id'': ''lab1'', \n     ''behaviors_labeled'': ''[\"\"mouse1,mouse2,attack\"\"]''},\n]\\)\n\n# Submission with integer agent_id \\(what might be happening\\)\nsubmission = pd.DataFrame\\([\n    {''video_id'': 1, ''agent_id'': 1, ''target_id'': 2, ''action'': ''attack'', \n     ''start_frame'': 0, ''stop_frame'': 10},\n]\\)\n\nprint\\(f''Solution agent_id type: {type\\(solution[\"\"agent_id\"\"].iloc[0]\\)}''\\)\nprint\\(f''Submission agent_id type: {type\\(submission[\"\"agent_id\"\"].iloc[0]\\)}''\\)\n\ntry:\n    score = mouse_fbeta\\(solution, submission\\)\n    print\\(f''Score: {score}''\\)\nexcept Exception as e:\n    print\\(f''Error: {e}''\\)\n    import traceback\n    traceback.print_exc\\(\\)\n\n# Check what behaviors_labeled expects\nprint\\(''\\\\n--- Behaviors labeled check ---''\\)\nprint\\(''behaviors_labeled expects: mouse1,mouse2,attack''\\)\nprint\\(''If submission has integer agent_id \\(1\\), the check would be:''\\)\nprint\\(''  str\\(1\\) + \"\",\"\" + str\\(2\\) + \"\",\"\" + \"\"attack\"\" = \"\"1,2,attack\"\"''\\)\nprint\\(''  This does NOT match \"\"mouse1,mouse2,attack\"\"!''\\)\n\")",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\" -c \"import pandas as pd; df = pd.read_csv\\(r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\kaggle\\\\input\\\\MABe-mouse-behavior-detection\\\\train.csv''\\); print\\(''behaviors_labeled sample from train.csv:''\\); print\\(df[''behaviors_labeled''].iloc[0][:1000]\\)\")",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\" -c \"\nimport sys\nsys.path.insert\\(0, r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer''\\)\n\nimport numpy as np\nimport pandas as pd\nimport torch\nfrom pathlib import Path\nfrom src.models.lightning_module import BehaviorRecognitionModule\n\n# Load model\ndevice = torch.device\\(''cpu''\\)\nckpt_path = r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\outputs\\\\checkpoints\\\\mabe-epoch=97-val_segment_f1=0.2440.ckpt''\nmodel = BehaviorRecognitionModule.load_from_checkpoint\\(ckpt_path, map_location=device, weights_only=False\\)\nmodel.eval\\(\\)\n\nbehaviors = model.behaviors\n\n# Simulated inference to check raw probability distribution\n# Let''s load one window of data and check the prediction distribution\nprecomputed_dir = Path\\(r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\kaggle\\\\input\\\\MABe-mouse-behavior-detection\\\\precomputed''\\)\nwindow_files = list\\(precomputed_dir.glob\\(''*/*.npz''\\)\\)\nprint\\(f''Found {len\\(window_files\\)} precomputed windows''\\)\n\n# Load one window\nif window_files:\n    sample = np.load\\(window_files[0]\\)\n    features = torch.from_numpy\\(sample[''features'']\\).unsqueeze\\(0\\).float\\(\\)\n    \n    with torch.no_grad\\(\\):\n        logits = model\\(features\\)\n        probs = torch.sigmoid\\(logits\\)\n    \n    # Get mean probability per class\n    mean_probs = probs[0].mean\\(dim=0\\).numpy\\(\\)\n    max_probs = probs[0].max\\(dim=0\\).values.numpy\\(\\)\n    \n    print\\(''\\\\n=== RAW MODEL OUTPUT ANALYSIS ===''\\)\n    print\\(''Class-wise statistics \\(sorted by max probability\\):''\\)\n    indices = np.argsort\\(-max_probs\\)\n    for i in indices[:15]:\n        print\\(f''{behaviors[i]:20s}: mean={mean_probs[i]:.4f}, max={max_probs[i]:.4f}''\\)\n    \n    print\\(f''\\\\nNumber of behaviors with max_prob > 0.39: {\\(max_probs > 0.39\\).sum\\(\\)}''\\)\n    print\\(f''Number of behaviors with max_prob > 0.30: {\\(max_probs > 0.30\\).sum\\(\\)}''\\)\n    print\\(f''Number of behaviors with max_prob > 0.20: {\\(max_probs > 0.20\\).sum\\(\\)}''\\)\n\")",
      "Bash(\"c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\.venv\\\\Scripts\\\\python.exe\" -c \"\nimport sys\nsys.path.insert\\(0, r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer''\\)\n\nfrom pathlib import Path\nfrom src.data.dataset import PrecomputedWindowDataset\n\nprecomputed_dir = Path\\(r''c:\\\\Users\\\\73506\\\\MABe-ConvTransformer\\\\kaggle\\\\input\\\\MABe-mouse-behavior-detection\\\\precomputed''\\)\n\nprint\\(''=== Testing Oversampling Implementation ===''\\)\n\n# Test without oversampling\nprint\\(''\\\\n1. Without oversampling:''\\)\nds_normal = PrecomputedWindowDataset\\(\n    root=precomputed_dir,\n    split=''train'',\n    apply_augment=False,\n    oversample_rare=False\n\\)\nprint\\(f''  Dataset length: {len\\(ds_normal\\)}''\\)\n\n# Test with oversampling\nprint\\(''\\\\n2. With oversampling \\(submit, chaseattack x10\\):''\\)\nds_oversample = PrecomputedWindowDataset\\(\n    root=precomputed_dir,\n    split=''train'',\n    apply_augment=False,\n    oversample_rare=True,\n    rare_behaviors=[''submit'', ''chaseattack''],\n    oversample_factor=10\n\\)\nprint\\(f''  Dataset length: {len\\(ds_oversample\\)}''\\)\nprint\\(f''  Increase: {len\\(ds_oversample\\) - len\\(ds_normal\\)} samples''\\)\n\n# Check that we can access items\nprint\\(''\\\\n3. Verify data access:''\\)\nsample = ds_oversample[0]\nprint\\(f''  Sample keys: {list\\(sample.keys\\(\\)\\)}''\\)\nprint\\(f''  Features shape: {sample[\"\"features\"\"].shape}''\\)\nprint\\(f''  Labels shape: {sample[\"\"labels\"\"].shape}''\\)\n\")"
    ]
  }
}
